#!/bin/sh

set -eo pipefail


#======================================================================================================================
# Add www user.
#======================================================================================================================

bcg-echo "Adding www user..."
bcg-adduser www
bcg-done


#======================================================================================================================
# Get Nginx Version.
#======================================================================================================================

cd /tmp

V=$(cat VERSION)
bcg-debug "install: Nginx version ${V}."


#======================================================================================================================
# Install Nginx and dependencies.
#======================================================================================================================

bcg-echo "Installing Nginx v${VERSION}..."
apk add --no-cache \
    ca-certificates \
    nginx=${VERSION}
mkdir -p /var/run/nginx
bcg-done


#======================================================================================================================
# Cleanup.
#======================================================================================================================

rm -rf /etc/nginx/conf.d/* /etc/nginx/http.d/* /var/www/*


#======================================================================================================================
# Link /var/www/localhost to /www.
#======================================================================================================================

ln -s /www /var/www/localhost
